(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/admin/post-game"],{"04ef":function(t,e,i){},"231d":function(t,e,i){"use strict";var n=i("04ef"),a=i.n(n);a.a},5321:function(t,e,i){"use strict";i.r(e);var n=i("f594"),a=i("598e");for(var s in a)"default"!==s&&function(t){i.d(e,t,(function(){return a[t]}))}(s);i("231d");var o,r=i("f0c5"),c=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);e["default"]=c.exports},"535e":function(t,e,i){"use strict";(function(t){i("1a2d"),i("921b");n(i("66fd"));var e=n(i("5321"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},"598e":function(t,e,i){"use strict";i.r(e);var n=i("f730"),a=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},f594:function(t,e,i){"use strict";var n,a=function(){var t=this,e=t.$createElement,i=(t._self._c,t.fileIsEmpty()),n=t.fileIsEmpty();t._isMounted||(t.e0=function(e){t.name=""},t.e1=function(e){t.source=""},t.e2=function(e){t.url=""},t.e3=function(e){t.registerUrl=""},t.e4=function(e){t.contact=""},t.e5=function(e){t.popupTypeFlag=!0},t.e6=function(e){t.popupTypeFlag=!1},t.e7=function(e){t.popupKindFlag=!0},t.e8=function(e){t.popupKindFlag=!1}),t.$mp.data=Object.assign({},{$root:{m0:i,m1:n}})},s=[];i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}))},f730:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("a34a"));function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e,i,n,a,s,o){try{var r=t[s](o),c=r.value}catch(u){return void i(u)}r.done?e(c):Promise.resolve(c).then(n,a)}function o(t){return function(){var e=this,i=arguments;return new Promise((function(n,a){var o=t.apply(e,i);function r(t){s(o,n,a,r,c,"next",t)}function c(t){s(o,n,a,r,c,"throw",t)}r(void 0)}))}}var r=function(){i.e("components/other/robin-editor/editor").then(function(){return resolve(i("1092"))}.bind(null,i)).catch(i.oe)},c=function(){i.e("components/uni-ui/uni-swipe-action/uni-swipe-action").then(function(){return resolve(i("9241"))}.bind(null,i)).catch(i.oe)},u=function(){Promise.all([i.e("common/vendor"),i.e("components/uni-ui/uni-swipe-action-item/uni-swipe-action-item")]).then(function(){return resolve(i("dbf0"))}.bind(null,i)).catch(i.oe)},l=function(){i.e("components/other/dynamic-tags/dynamic-tags").then(function(){return resolve(i("10fc"))}.bind(null,i)).catch(i.oe)},h=function(){Promise.all([i.e("common/vendor"),i.e("components/k-ui/k-game-detail/k-game-detail")]).then(function(){return resolve(i("3a75"))}.bind(null,i)).catch(i.oe)},d=function(){i.e("components/uni-ui/uni-number-box/uni-number-box").then(function(){return resolve(i("551e"))}.bind(null,i)).catch(i.oe)},g={components:{myEditor:r,uniSwipeAction:c,uniSwipeActionItem:u,dynamicTags:l,kGameDetail:h,uniNumberBox:d},data:function(){return{name:"",source:"",url:"",registerUrl:"",contact:"",date1:"",date2:"",date3:"",date4:"",gameContent:"",gameType:"",gameTypeList:["院级","校级","市级","省级","国家级","国际级","其他"],popupTypeFlag:!1,category:"",categories:[],categoryIds:[],popupKindFlag:!1,stepActive:0,stepList:[{cuIcon:"usefullfill",name:"基本信息"},{cuIcon:"radioboxfill",name:"竞赛描述"},{cuIcon:"radioboxfill",name:"上传附件"},{cuIcon:"roundcheckfill",name:"确认发布"}],gameWayRadio:"1",num:1,membersShowFlag:!1,picList:[],options:[{text:"删除",style:{backgroundColor:"#dd524d"}}],tagList:[],enableDel:!0,enableAdd:!0,startTime:"",endTime:"",games:[],poster:[],curGameId:"",user:"",editFlag:!1}},mounted:function(){this.user=this.$store.getters.getUserInfo},onLoad:function(t){void 0!=t.id&&(console.log(t.id),this.curGameId=t.id,this.editFlag=!0,this.loadData()),this.getCategories(),this.getStartDate(),this.getEndDate()},methods:{saveEditor:function(t){this.gameContent=t.htmlData},resetEditor:function(){this.gameContent=""},Date1Change:function(t){this.date1=t.detail.value},Date2Change:function(t){this.date2=t.detail.value},Date3Change:function(t){this.date3=t.detail.value},Date4Change:function(t){this.date4=t.detail.value},test:function(){console.log("this.category: "+JSON.stringify(this.category)),console.log(this.categories)},loadData:function(){var t=o(n.default.mark((function t(){var e,i,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$api.request({url:"/game/"+this.curGameId});case 2:e=t.sent,console.log(e),200==e.status?(i=this,a=e.data.game,this.name=a.gameName,this.source=a.gameSource,this.url=a.gameUrl,this.registerUrl=a.registerUrl,this.gameType=a.gameType,this.category=a.gameCategory,a.teamSize>1&&(this.gameWayRadio="2",this.membersShowFlag=!0),this.num=a.teamSize,this.date1=a.registerStartTime,this.date2=a.registerEndTime,this.date3=a.gameStartTime,this.date4=a.gameEndTime,this.gameContent=a.gameContent,this.contact=a.contact,a.gameTags.forEach((function(t){i.tagList.push(t.tagName)})),this.picList.push(a.posterUrl)):this.$api.msg("服务器正忙~");case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getStartDate:function(){this.startTime="2018-01-01"},getEndDate:function(){var t=new Date,e=t.getFullYear()+2,i=e+"-01-01";this.endTime=i},chooseType:function(t){var e=t.detail,i=(e.value,e.index);this.gameType=i+1,this.popupTypeFlag=!1},closeTypePopup:function(){this.popupTypeFlag=!1},chooseKind:function(t){var e=t.detail,i=e.value,n=e.index;this.category={id:this.categoryIds[n],category:i},console.log(this.category),this.popupKindFlag=!1},closeKindPopup:function(){this.popupKindFlag=!1},onChangeGameWay:function(t){this.gameWayRadio=String(t.detail),2==this.gameWayRadio?this.membersShowFlag=!0:(this.membersShowFlag=!1,this.num=1)},change:function(t){this.num=t},nextStep:function(){if(0==this.stepActive){if(""==this.name)return void this.$api.msg("请填写竞赛名称~");if(""==this.source)return void this.$api.msg("请填写主办方~");if(""==this.gameType)return void this.$api.msg("请选择竞赛级别~");if(""==this.category)return void this.$api.msg("请选择竞赛类别~");if(""==this.date1)return void this.$api.msg("请选择报名开始时间~");if(""==this.date2)return void this.$api.msg("请选择报名结束时间~");if(""==this.date3)return void this.$api.msg("请选择竞赛开始时间~");if(""==this.date4)return void this.$api.msg("请选择竞赛结束时间~")}1!=this.stepActive||""!=this.gameContent?this.stepActive=this.stepActive>=4?this.stepActive:this.stepActive+1:this.$api.msg("请填写竞赛内容并保存~")},postGame:function(){if(0!=this.picList.length){var e=this;0==this.tagList.length?t.showModal({title:"提示",content:"确定不添加竞赛标签吗？",showCancel:!0,confirmText:"确定",success:function(i){i.confirm&&(t.showLoading({title:"发布中..."}),setTimeout((function(){""==e.curGameId?e.post("/game/add"):e.post("/game/update")}),1e3))}}):(t.showLoading({title:"发布中..."}),setTimeout((function(){""==e.curGameId?e.post("/game/add"):e.post("/game/update")}),1e3))}else this.$api.msg("请上传竞赛海报~")},finsh:function(){t.navigateBack()},deleteGame:function(){if(this.user.userType>=3)t.showModal({title:"提示",content:"权限不足，无法删除~",showCancel:!1,confirmText:"返回",success:function(t){}});else{var e=this;t.showModal({title:"删除提示",content:"删除不可恢复，确定删除吗？",showCancel:!0,confirmText:"删除",success:function(i){i.confirm&&(t.showLoading({title:"删除中..."}),e.delete())}})}},delete:function(){var e=o(n.default.mark((function e(){var i;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.request({url:"/game/delete/"+this.curGameId});case 2:i=e.sent,t.hideLoading(),200==i.status?(this.$api.msg("删除成功"),t.navigateBack()):2001==i.status||2002==i.status?this.$api.msg(i.msg):this.$api.msg("系统繁忙");case 5:case"end":return e.stop()}}),e,this)})));function i(){return e.apply(this,arguments)}return i}(),editGame:function(){var e=this;if(this.user.userType>=3)t.showModal({title:"提示",content:"权限不足,无法编辑~",showCancel:!1,confirmText:"返回",success:function(t){}});else{t.showModal({title:"编辑提示",content:"您确定要重新编辑吗？",showCancel:!0,confirmText:"确定",success:function(t){t.confirm&&(e.editFlag=!0,e.stepActive=0)}})}},post:function(){var e=o(n.default.mark((function e(i){var a,s=this;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this,e.next=3,this.$api.request({url:i,contentType:"application/json",method:"POST",data:{game:{id:this.curGameId,gameName:this.name,posterUrl:this.picList[0],gameContent:this.gameContent,contact:this.contact,registerStartTime:this.date1,registerEndTime:this.date2,gameStartTime:this.date3,gameEndTime:this.date4,gameSource:this.source,gameType:this.gameType,gameCategory:this.category,gameUrl:this.url,registerUrl:this.registerUrl,teamSize:this.num},tags:JSON.stringify(this.tagList)}});case 3:a=e.sent,console.log(a),console.log(a.status),200==a.status?(console.log("game发布成功"),this.curGameId=a.data.id,this.picList[0].startsWith("http://tmp")||this.picList[0].startsWith("wxfile:")?(console.log("更新图片"),this.upload()):(t.hideLoading(),this.$api.msg("发布成功~"),setTimeout((function(){t.showLoading({title:"预览中..."}),s.getGame(s.curGameId)}),1e3))):this.$api.msg("服务器正忙~");case 7:case"end":return e.stop()}}),e,this)})));function i(t){return e.apply(this,arguments)}return i}(),getGame:function(){var e=o(n.default.mark((function e(i){var a,s=this;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(i),e.next=3,this.$api.request({url:"/game/"+i});case 3:a=e.sent,200==a.status&&(this.games=a.data.game,this.poster[0]=a.data.poster,setTimeout((function(){s.stepActive=3,t.hideLoading()}),1e3));case 5:case"end":return e.stop()}}),e,this)})));function i(t){return e.apply(this,arguments)}return i}(),lastStep:function(){this.stepActive=this.stepActive<=4?this.stepActive-1:this.stepActive},afterReadPic:function(t){var e=t.detail.file;this.picList.push(e.path)},upload:function(){var e=this;console.log(this.picList),t.uploadFile({url:this.$config.def().baseUrl+"/upload/upload/"+this.curGameId,filePath:e.picList[0],name:"file",formData:{},success:function(i){var n=JSON.parse(i.data);200==n.status?(t.hideLoading(),e.$api.msg("发布成功~"),setTimeout((function(){t.showLoading({title:"预览中..."}),e.getGame(e.curGameId)}),1e3)):e.$api.msg("服务器正忙~")},fail:function(){t.hideLoading(),e.$api.msg("服务器正忙~")}})},beforeRead:function(t){},fileIsEmpty:function(){return 0==this.picList.length},previewOnClick:function(t){0==t.index&&(this.picList=[])},previewChange:function(t){},addTag:function(t){console.log(t),this.tagList.length<3&&t.allTags.length<=3?this.tagList=t.allTags:this.$api.msg("最多只能添加三个")},delTag:function(t){console.log(t),this.tagList=t.allTags},getCategories:function(){var t=o(n.default.mark((function t(){var e,i;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$api.request({url:"/category"});case 2:e=t.sent,i=this,e.data.forEach((function(t){i.categories.push(t.category),i.categoryIds.push(t.id)}));case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}};e.default=g}).call(this,i("543d")["default"])}},[["535e","common/runtime","common/vendor"]]]);